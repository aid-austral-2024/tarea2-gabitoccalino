---
title: "Tarea 2: Análisis Inteligente de Datos"
autor:
  - "Gabriel Toccalino"
format:
  html:     
    embed-resources: true
    css: estilos.css
---

# Introducción.

## Definición.

En los motores de combustión, la protrusión del pistón se refiere a cuánto sobresale la parte superior del pistón por encima de la superficie del bloque del cilindro cuando el pistón está en su punto más alto dentro del cilindro (Punto Muerto Superior o PMS).

![Protrusión del pistón](images/piston_protrusion.png)

## ¿Por qué es importante la Protrusión del Pistón?

-   Relación de Compresión: La relación de compresión es un factor crítico en el rendimiento, eficiencia y emisiones de un motor. La protrusión del pistón afecta el volumen de la cámara de combustión, lo que influye directamente en la relación de compresión.

-   Eficiencia de Combustión: Una protrusión adecuada del pistón garantiza que la mezcla aire-combustible se comprima correctamente, lo que resulta en una combustión óptima. Esto mejora la potencia del motor y la eficiencia del combustible.

-   Durabilidad del Motor: Una protrusión adecuada del pistón mantiene la integridad estructural de los componentes del motor, previniendo desgastes prematuros.

## ¿Cómo se mide?

La protrusión del pistón se mide con un comparador de carátula. El pistón se lleva al PMS y el comparador se utiliza para medir la distancia que sobresale el pistón por encima de la superficie del bloque del cilindro.

![Medición de la protrusión del pistón](images/measurement.png)

# Problemática abordada.

Para la medición de la característica mencionada en un proceso de ensamblaje de motores diésel, el comparador está vinculado a un mecanismo de control automático. De este modo, si la protrusión del pistón se encuentra dentro de los límites de aceptación, el proceso continúa. En caso contrario, el producto debe ser revisado y reparado.

Durante una auditoría realizada por el departamento de Calidad, se detectó que las mediciones de la protrusión del pistón estaban siendo manipuladas. El personal operativo explicó que ciertos modelos de motores tienden a tener una altura de protrusión que queda apenas por debajo del límite permitido. En lugar de rechazar el producto, se "corrige" la medición del comparador, de manera que la nueva medición quede dentro de los límites de especificación.

El motivo de este comportamiento parece ser cultural. Según se indicó, esta problemática es histórica y ya ha sido reportada a las áreas de soporte correspondientes. Ante la falta de respuesta y considerando los problemas generados en el proceso, se optó por esta práctica, que evidentemente dista de ser la ideal.

La propuesta del departamento de Calidad es llevar a cabo una investigación en profundidad sobre este asunto para solucionar los inconvenientes que enfrenta el personal operativo, así como también para asegurar la veracidad y la calidad de las mediciones realizadas en el producto final.

# Análisis preliminar.

En primera instancia, se solicitó al personal operativo que se pusiera fin a la mala práctica y que comenzara a dejar registro de las mediciones reales, con el fin de contar con datos fehacientes.

En segundo lugar, se procedió a relevar los modelos de motores afectados por la problemática. Se detectó que todos los modelos afectados pertenecen a una familia común que comparte varios componentes, como el bloque y el conjunto de compresión. En total, son cuatro los modelos de motores afectados.Esto permitió acotar rápidamente el análisis.

Para esta familia de producto, la medición de protrusión del pistón debe estar en el rango 0.63 mm a 0.87 mm para ser considerada como aceptable.

# Análisis descriptivo.

## Librerías utilizadas

```{r}

library(readxl)
library(ggplot2)
library(dplyr)
library(knitr)

```

## Importar y limpiar los datos.

Se encuentran irregularidades en los datos obtenidos de la base de datos. Algunos de ellos utilizan el punto como separador de decimales mientras que otros utilizan la coma.

En cuanto a los datos propiamente, se encuentran varias mediciones con valor el valor cero. Esto corresponde a mediciones que no fueron realizadas debido a que el equipo se encontraba fuera de servicio o en mantenimiento.Por otro lado, también se evidencia una gran cantidad de valores atípicos que deberán ser filtrados.

```{r}

TDC <- read_excel("C:/Users/M2WJMV5/Downloads/TDC.xlsx")

TDC <- TDC |>
  mutate(VALUE = if_else(VALUE == 0, NA_real_, VALUE))

# Filtrar los datos eliminando outliers y asigno un grupo ----

Q1 <- quantile(TDC$VALUE, 0.25, na.rm = TRUE)
Q3 <- quantile(TDC$VALUE, 0.75, na.rm = TRUE)
lower_bound <- Q1 - 1.5 * (Q3 - Q1)
upper_bound <- Q3 + 1.5 * (Q3 - Q1)

```

Se divide la muestra de datos históricos en dos subpoblaciones. El "Grupo A" corresponde a los datos previos al inicio de la investigación, mientras que el "Grupo B" incluye los datos obtenidos después de que se dejó de manipular el instrumento de medición.

```{r}

TDC <- TDC |>
  filter(VALUE >= lower_bound & VALUE <= upper_bound) |>
  mutate(GRUPO = ifelse(TIME_STAMP < as.POSIXct("2024-08-07 00:00:00"), "A", "B"))

```

Se crea un gráfico de dispersión para una primera visualización de los datos.

```{r}

lower_limit <- 0.75 - 0.12  # 0.63
nominal <- 0.75
upper_limit <- 0.75 + 0.12  # 0.87

ggplot(data = TDC, aes(x = TIME_STAMP, y = VALUE, color = TOP_NUMBER)) +
  geom_point(size = 2) +
  labs(title = "Gráfico de Dispersión de altura PMS",
       x = "Time Stamp",
       y = "Value",
       color = "Top Number") +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") + 
  scale_y_continuous(limits = c(0.5, 0.9)) +
  geom_vline(xintercept = as.POSIXct("2024-08-07"), linetype = "dashed", color = "red") + 
  annotate("text", x = as.POSIXct("2024-08-15"), y = 0.85, label = "PUNTO DE CORTE", vjust = -1, color = "red") +  
  geom_hline(yintercept = lower_limit, linetype = "dashed", color = "black") + 
  geom_hline(yintercept = upper_limit, linetype = "dashed", color = "black") +
  geom_hline(yintercept = nominal, linetype = "dashed", color = "black") +
  theme(legend.position = "bottom",
        legend.justification = "center",
        legend.title.align = 0.5)

```

Cálculo de principales medidas de resumen para ambos grupos.

```{r}

Resumen <- TDC |>
  group_by(GRUPO) |>
  summarise(
    media = round(mean(VALUE, na.rm = TRUE), 3),
    mediana = round(median(VALUE, na.rm = TRUE), 3),
    sd = round(sd(VALUE, na.rm = TRUE), 3),
    min = round(min(VALUE, na.rm = TRUE), 3),
    max = round(max(VALUE, na.rm = TRUE), 3),
    n = n()
  )
  
kable(Resumen, caption = "Medidas de Resumen por Grupo")

```
